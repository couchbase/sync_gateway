# Copyright 2022-Present Couchbase, Inc.
#
# Use of this software is governed by the Business Source License included
# in the file licenses/BSL-Couchbase.txt.  As of the Change Date specified
# in that file, in accordance with the Business Source License, use of this
# software will be governed by the Apache License, Version 2.0, included in
# the file licenses/APL2.txt.
parameters:
  - $ref: ../../components/parameters.yaml#/db
get:
  summary: Get information about the current user
  description: This will get the information about the current user.
  responses:
    "200":
      $ref: ../../components/responses.yaml#/User-session-information
    "401":
      $ref: ../../components/responses.yaml#/Unauthorized
    "404":
      $ref: ../../components/responses.yaml#/Not-found
  tags:
    - Session
  operationId: get_db-_session
post:
  summary: Create a new user session
  description: |-
    Generates a login session for the user based on the credentials provided in the request body or if that fails (due to invalid credentials or none provided at all), generates the new session for the currently authenticated user instead. On a successful session creation, a session cookie is stored to keep the user authenticated for future API calls.

    If `Origin` header is passed to this endpoint, the `Origin` header must match both the `cors.login_origin` and `cors.origin` configuration options.
  requestBody:
    description: The body can be used to override the credentials of the authenticating user, or blank if getting a user session for the authenticating user.
    content:
      application/json:
        schema:
          oneOf:
            - type: "null"
              title: "Empty Body"
            - type: object
              title: "User Credentials"
              properties:
                name:
                  description: User name to generate the session for.
                  type: string
                password:
                  description: Password of the user to generate the session for.
                  type: string
  responses:
    "200":
      $ref: ../../components/responses.yaml#/User-session-information
    "400":
      $ref: ../../components/responses.yaml#/Invalid-CORS-LoginOrigin
    "401":
      $ref: ../../components/responses.yaml#/Unauthorized
    "404":
      $ref: ../../components/responses.yaml#/Not-found
  tags:
    - Session
  operationId: post_db-_session
delete:
  summary: Log out
  description: |-
    Invalidates the session for the currently authenticated user and removes their session cookie.

    If `Origin` header is passed to this endpoint, the `Origin` header must match both the `cors.login_origin` and `cors.origin` configuration options.
  responses:
    "200":
      description: Successfully removed session (logged out)
    "400":
      $ref: ../../components/responses.yaml#/Invalid-CORS-LoginOrigin
    "401":
      $ref: ../../components/responses.yaml#/Unauthorized
    "404":
      $ref: ../../components/responses.yaml#/Not-found
  tags:
    - Session
  operationId: delete_db-_session
