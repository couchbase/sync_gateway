# Copyright 2024-Present Couchbase, Inc.
#
# Use of this software is governed by the Business Source License included
# in the file licenses/BSL-Couchbase.txt.  As of the Change Date specified
# in that file, in accordance with the Business Source License, use of this
# software will be governed by the Apache License, Version 2.0, included in
# the file licenses/APL2.txt.
parameters:
  - $ref: ../../components/parameters.yaml#/keyspace
  - $ref: ../../components/parameters.yaml#/doc_id
post:
  summary: Run a doc body through the Import filter and return results.
  description: |-
    Runs a document body through the import filter and return whether its
    imported or not, and any error messages. If no custom import filter is
    provided in the request body, the default or user-defined import filter
    is used.

    * Sync Gateway Application Read Only
  requestBody:
    content:
      application/json:
        schema:
          type: object
          properties:
            import_filter:
              description: |-
                A JavaScript function that all imported documents in the
                default scope and collection are ran through in order to filter
                out what to import and what not to import.
              type: string
              example: 'function(doc) { if (doc.type != ''mobile'') { return false; } return true; }'
            doc:
              $ref: ../../components/schemas.yaml#/Document
  responses:
    '200':
      description: Document Processed by import filter successfully
      content:
        application/json:
          schema:
            type: object
            properties:
              shouldImport:
                description: Whether this document would be imported after being processed by the import filter.
                type: boolean
              error:
                description: Errors thrown by the Import filter.
                type: string
              logging:
                description: Logging emitted by the import filter during evaluation.
                type: object
                properties:
                  errors:
                    description: Error messages logged by the import filter.
                    type: array
                    items:
                      type: string
                  info:
                    description: Info messages logged by the import filter.
                    type: array
                    items:
                      type: string
    '404':
      $ref: ../../components/responses.yaml#/Not-found
  parameters:
    - $ref: ../../components/parameters.yaml#/doc_id
  tags:
    - Document
  operationId: get_keyspace-import_filter-docid
