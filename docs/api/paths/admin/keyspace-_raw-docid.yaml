# Copyright 2022-Present Couchbase, Inc.
#
# Use of this software is governed by the Business Source License included
# in the file licenses/BSL-Couchbase.txt.  As of the Change Date specified
# in that file, in accordance with the Business Source License, use of this
# software will be governed by the Apache License, Version 2.0, included in
# the file licenses/APL2.txt.
parameters:
  - $ref: ../../components/parameters.yaml#/keyspace
  - $ref: ../../components/parameters.yaml#/docid
get:
  summary: Get a document with the corresponding metadata
  description: |-
    Returns a document's latest revision with its metadata as stored.

    Note: The direct use of this endpoint is unsupported. The sync metadata is maintained internally by Sync Gateway and its structure can change. It should not be used to drive business logic of applications since the response to the `/{db}/_raw/{id}` endpoint can change at any time.

    Required Sync Gateway RBAC roles:

    * Sync Gateway Application
    * Sync Gateway Application Read Only
  parameters:
    - $ref: ../../components/parameters.yaml#/include_doc
    - name: redact
      in: query
      description: This redacts sensitive parts of the response. Cannot be used when `include_doc=true`
      schema:
        type: boolean
    - name: salt
      in: query
      description: Whether to apply redaction with a custom salt - the intention here is to allow consistent hashing with a log collection. If this value is not set, a random salt will be used.
      schema:
        type: string
  responses:
    '200':
      description: Document found successfully
      content:
        application/json:
          schema:
            type: object
            example:
              {"channels": ["a", "ecWZjZjcpg"], "myblob": {"length": 11, "content_type": "text/plain", "digest": "sha1-Kq5sNclPz7QV2+lfQIuc6R7oRu0=", "@type": "blob"}, "_xattrs": {"_sync": {"cas": "0x000097d3e4e45418", "channel_set": [{"name": "a", "start": 3128}, {"name": "ecWZjZjcpg", "start": 3128}], "channel_set_history": null, "channels": {"a": null, "ecWZjZjcpg": null}, "cluster_uuid": "ba2606db6dccedbcf4a6d3f66e242b8b", "history": {"channels": [["a", "ecWZjZjcpg"]], "parents": [-1], "revs": ["1-525e04f141fbd0394d693531593105b88dbe0b25"]}, "recent_sequences": [3128], "rev": {"rev": "1-525e04f141fbd0394d693531593105b88dbe0b25", "src": "zTWkmBiYZgNQo7BHVZrB/Q", "ver": "0x000097d3e4e45418"}, "sequence": 3128, "time_saved": "2025-07-23T14:37:06.407392+01:00", "value_crc32c": "0x38db3c8c"}, "_globalSync": {"attachments_meta": {"blob_/myblob": {"content_type": "text/plain", "digest": "sha1-Kq5sNclPz7QV2+lfQIuc6R7oRu0=", "length": 11, "revpos": 1, "stub": true, "ver": 2}}}, "_mou": null, "_vv": {"cvCas": "0x000097d3e4e45418", "src": "zTWkmBiYZgNQo7BHVZrB/Q", "ver": "0x000097d3e4e45418"}}}
            additionalProperties: true
            properties:
              _xattrs:
                description: The extended attributes of the document, which can include Sync Gateway metadata, such as revision history, channel information, and other sync-related data. This is non-exhaustive and only includes xattrs that are relevant to Sync Gateway. Any `null` values indicate the xattr is not present on the document.
                type: object
                properties:
                  _sync:
                    description: Sync Gateway metadata for the document.
                    type: object
                    nullable: true
                    additionalProperties: true
                  _globalSync:
                    description: Globally replicated Sync Gateway metadata for the document.
                    type: object
                    nullable: true
                    additionalProperties: true
                  _mou:
                    description: Metadata-only update information.
                    type: object
                    nullable: true
                    additionalProperties: true
                  _vv:
                    description: Version Vector for the document.
                    type: object
                    nullable: true
                    additionalProperties: true
                  $document:
                    description: Document virtual xattrs.
                    type: object
                    nullable: true
                    additionalProperties: true
    '400':
      $ref: ../../components/responses.yaml#/request-problem
    '403':
      $ref: ../../components/responses.yaml#/Unauthorized-database
    '404':
      $ref: ../../components/responses.yaml#/Not-found
  tags:
    - Document
  operationId: get_keyspace-_raw-docid
